// Generated by CoffeeScript 1.6.1
(function() {
  var confirm, deleteReport;

  getReports();

  getReportNum();

  confirm = function(reportId) {
    return $("#dialog-confirm").dialog({
      dialogClass: "no-close",
      resizable: false,
      height: 160,
      modal: true,
      buttons: {
        "删除": function() {
          deleteReport(reportId);
          return $(this).dialog("close");
        },
        Cancel: function() {
          return $(this).dialog("close");
        }
      }
    });
  };

  $("#reportList").on("click", "p.delete", function() {
    var reportId;
    reportId = $(this).attr("reportId");
    return confirm(reportId);
  });

  deleteReport = function(reportId) {
    return ReportModel.deleteReport({
      reportId: reportId
    }, function(response) {
      var page, report, reports, _i, _len;
      if (response.state === 0) {
        return;
      }
      reports = reportvm.reports();
      for (_i = 0, _len = reports.length; _i < _len; _i++) {
        report = reports[_i];
        if (report["id"] === reportId) {
          reportvm.reports.remove(report);
          reportvm.reportNum(reportvm.reportNum() - 1);
          if (reportvm.reports().length === 0 && reportvm.currentPage() > 1) {
            page = reportvm.currentPage() - 1;
            gotoPage(page);
          }
          return;
        }
      }
    });
  };

}).call(this);
