// Generated by CoffeeScript 1.6.1
(function() {
  var departmemtModel, departmentViewModel, departmentvm, init;

  departmentViewModel = function() {
    var self;
    self = this;
    self.departmentName = ko.observable('');
    self.validDepartmentName = ko.computed(function() {
      var dname;
      dname = $.trim(self.departmentName());
      return dname.length >= 1 && dname.indexOf(":") === -1;
    });
    self.departments = ko.observableArray(null);
    self.selectedParentDepartment = ko.observable(null);
    self.submit = function() {
      var data;
      if (self.validDepartmentName()) {
        data = {
          departmentName: self.departmentName(),
          pid: self.selectedParentDepartment()["id"]
        };
        return $.post("/admin/createDepartment", data, function(data) {
          alert(data.message);
          return data;
        }, "json");
      }
    };
    return self;
  };

  departmentvm = new departmentViewModel();

  ko.applyBindings(departmentvm);

  init = function() {
    $.get("/admin/alldepartments", function(data) {
      var departments;
      departments = departmemtModel.getAllDepartments(data.data);
      console.log(departments);
      departmentvm.departments(departments);
      return null;
    }, "json");
    return null;
  };

  init();

  departmemtModel = (function() {

    function departmemtModel() {}

    departmemtModel.getAllDepartments = function(data) {
      var childOfKey, departmentId, key, key2, result, resultObj, value, value2;
      resultObj = {};
      for (key in data) {
        value = data[key];
        childOfKey = key.split(":");
        departmentId = childOfKey[0];
        resultObj[departmentId] = {
          id: departmentId
        };
        if (childOfKey[1] === "name") {
          resultObj[departmentId]["name"] = value;
        } else if (childOfKey[1] === "pid") {
          resultObj[departmentId]["pid"] = value;
        }
      }
      result = [];
      for (key2 in resultObj) {
        value2 = resultObj[key2];
        result.push(value2);
      }
      return result;
    };

    return departmemtModel;

  })();

}).call(this);
